<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for collateralSettler/CollateralSettlerVeANGLE.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">collateralSettler/</a> CollateralSettlerVeANGLE.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>111/111</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>50/50</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>15/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>117/117</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">56×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">44×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: GPL-3.0
&nbsp;
pragma solidity ^0.8.7;
&nbsp;
import "./CollateralSettlerVeANGLEEvents.sol";
&nbsp;
/// @title IVeANGLE
/// @author Angle Core Team
/// @notice Interface for the veANGLE contract
/// @dev It is needed to be able to query the veANGLE balance of each address interacting with the CollateralSettler
interface IVeANGLE {
    function balanceOf(address account) external returns (uint256);
}
&nbsp;
/// @title CollateralSettlerVeANGLE
/// @author Angle Core Team
/// @notice A contract to settle the positions associated to a collateral for a given stablecoin
/// @dev In this contract the term LP refers to both SLPs and HAs
// solhint-disable-next-line max-states-count
contract CollateralSettlerVeANGLE is ICollateralSettler, CollateralSettlerVeANGLEEvents, AccessControl, Pausable {
    using SafeERC20 for IERC20;
&nbsp;
    /// @notice Role for governors only
    bytes32 public constant GOVERNOR_ROLE = keccak256("GOVERNOR_ROLE");
    /// @notice Role for `StableMaster`. This role is also given to the governor addresses
    bytes32 public constant STABLEMASTER_ROLE = keccak256("STABLEMASTER_ROLE");
    /// @notice Base that is used to compute ratios and floating numbers
    uint256 public constant BASE_TOKENS = 10**18;
    /// @notice Base that is used to define parameters that have a floating value
    uint256 public constant BASE_PARAMS = 10**9;
&nbsp;
    // =================== References to contracts =================================
&nbsp;
    /// @notice Address of the `PerpetualManager` corresponding to the pool being closed
    IPerpetualManagerFront public immutable perpetualManager;
&nbsp;
    /// @notice Address of the `SanToken` corresponding to the pool being closed
    ISanToken public immutable sanToken;
&nbsp;
    /// @notice Address of the `AgToken` contract corresponding to the pool being closed
    IAgToken public immutable agToken;
&nbsp;
    /// @notice Address of the `PoolManager` corresponding to the pool being closed
    IPoolManager public immutable poolManager;
&nbsp;
    /// @notice Address of the corresponding ERC20 token
    IERC20 public immutable underlyingToken;
&nbsp;
    /// @notice Reference to the veANGLE contract
    IVeANGLE public immutable veANGLE;
&nbsp;
    /// @notice Address of the Oracle contract corresponding to the pool being closed
    /// It is used to fetch the price at which stablecoins are going to be converted in collateral at the end
    /// of the settlement period
    IOracle public immutable oracle;
&nbsp;
    // ========================= Activation Variables ==============================
&nbsp;
    /// @notice Base used in the collateral implementation (ERC20 decimal)
    /// This parameter is set in the `constructor`
    uint256 public collatBase;
&nbsp;
    /// @notice Value of the oracle at settlement trigger time
    /// It is the one that is used to compute HAs claims
    /// Note that the oracle value for HAs is going to be slightly different than that for users
    /// For HAs, it is as if at the time of trigger of collateral settlement, their positions were forced closed
    /// without needing to pay fees
    uint256 public oracleValueHA;
&nbsp;
    /// @notice Value of the oracle at the end of the claim period. This is the value that is used to settle users
    /// The reason for using a different value than for HAs is that the real value of the oracle could change
    /// during the claim time. In case of the revokation of a single collateral, there could be, if we used the same value as HAs,
    /// arbitrages among users seeing that the value of the oracle at which they are going to be settled differ
    /// from the current oracle value. Or in case of multiple collaterals being revoked at the same time, users could see
    /// a bargain in a collateral and all come to redeem one collateral in particular
    uint256 public oracleValueUsers;
&nbsp;
    /// @notice Exchange rate between sanTokens and collateral at settlement trigger time
    uint256 public sanRate;
&nbsp;
    /// @notice Maximum number of stablecoins that can be claimed using this collateral type
    /// The reason for this parameter is that in case of generalized collateral settlement where all collateral types
    /// are settled, it prevents users from all claiming the same collateral thus penalizing HAs and SLPs of this
    /// collateral and advantaging HAs and SLPs of other collateral types.
    /// This parameter is set equal to the `stocksUsers` for this collateral type at the time of activation
    uint256 public maxStablecoinsClaimable;
&nbsp;
    /// @notice Total amount of collateral to redistribute
    uint256 public amountToRedistribute;
&nbsp;
    /// @notice Time at which settlement was triggered, initialized at zero
    uint256 public startTimestamp;
&nbsp;
    // ======================= Accounting Variables ================================
&nbsp;
    /// @notice Number used a boolean to see if the `setAmountToRedistributeEach` function
    /// has already been called
    /// @dev This function can only be called once throughout the lifetime of the contract
    uint256 public baseAmountToEachComputed;
&nbsp;
    /// @notice Sum of the claims of users which do not own veANGLE (expressed in stablecoin value)
    uint256 public totalSupplyUserClaims;
&nbsp;
    /// @notice Sum of the claims of users which own veANGLE (expressed in stablecoin value)
    uint256 public totalSupplyUserClaimsVeANGLE;
&nbsp;
    /// @notice Sum of the claims from LPs (expressed in collateral value)
    uint256 public totalSupplyLpClaims;
&nbsp;
    /// @notice Sum of the claims from LPs which have veANGLE (expressed in collateral value)
    uint256 public totalSupplyLpClaimsVeANGLE;
&nbsp;
    /// @notice Ratio between what can be given and the claim for each user with veANGLE
    /// It is going to be updated (like the quantities below) only once at the end of the claim period
    uint64 public baseAmountToUserGov;
&nbsp;
    /// @notice Ratio between what can be given and the claim for each user
    uint64 public baseAmountToUser;
&nbsp;
    /// @notice Ratio between what can be given and the claim for each LP with veANGLE
    uint64 public baseAmountToLpGov;
&nbsp;
    /// @notice Ratio between what can be given and the claim for each LP
    uint64 public baseAmountToLp;
&nbsp;
    // ============================ Parameters =====================================
&nbsp;
    /// @notice Used to compute the portion of the user claim that is going to be considered as a claim
    /// with veANGLE for a unit amount of veANGLE owned
    /// Attention, this ratio should be between an amount of veANGLE and an amount of stablecoins
    uint64 public proportionalRatioGovUser;
&nbsp;
    /// @notice Used to compute the portion of the HA or SLP claim that is going to be considered as a claim
    /// with veANGLE for a unit amount of veANGLE owned
    uint64 public proportionalRatioGovLP;
&nbsp;
    /// @notice Time after the trigger in which users and LPs can come and claim their collateral
    uint256 public claimTime;
&nbsp;
    // ============================= Mappings ======================================
&nbsp;
    /// @notice Mapping between an address and a claim (in collateral) for a stable holder
    mapping(address =&gt; uint256) public balanceOfUserClaims;
&nbsp;
    /// @notice Mapping between a user address with veANGLE and its claim
    mapping(address =&gt; uint256) public balanceOfUserClaimsVeANGLE;
&nbsp;
    /// @notice Mapping between the address of a LP and a claim
    mapping(address =&gt; uint256) public balanceOfLpClaims;
&nbsp;
    /// @notice Mapping between the address of a LP with veANGLE and its claim
    mapping(address =&gt; uint256) public balanceOfLpClaimsVeANGLE;
&nbsp;
    /// @notice Mapping to check whether a HA perpetual has already been redeemed
    mapping(uint256 =&gt; uint256) public haClaimCheck;
&nbsp;
    // ================================= Modifiers =================================
&nbsp;
    /// @notice Checks to see if the contract is currently in claim period
    modifier onlyClaimPeriod() {
        require(
            startTimestamp != 0 &amp;&amp; block.timestamp &lt; claimTime + startTimestamp &amp;&amp; block.timestamp &gt; startTimestamp,
            "57"
        );
        _;
    }
&nbsp;
    /// @notice Checks to see if the base amounts to distribute to each category have already been computed
    /// @dev This allows to verify if users and LPs can redeem their collateral
    /// @dev As the `baseAmountToEachComputed` can only be changed from 0 during redeem period, this modifier
    /// allows at the same time to check if claim period is over
    modifier onlyBaseAmountsComputed() {
        require(baseAmountToEachComputed != 0, "58");
        _;
    }
&nbsp;
    // =============================== Constructor =================================
&nbsp;
    /// @notice Collateral settler constructor
    /// @param _poolManager Address of the corresponding `PoolManager`
    /// @param _veANGLE Address of the veANGLE token
    /// @param _claimTime Duration in which users and LPs will be able to claim their collateral
    /// @param governorList List of the governor addresses of the protocol
    constructor(
        IPoolManager _poolManager,
        IVeANGLE _veANGLE,
        uint256 _claimTime,
        address[] memory governorList
    ) {
        require(address(_veANGLE) != address(0), "0");
        // Retrieving from the `_poolManager` all the correct references, this guarantees the integrity of the contract
        poolManager = _poolManager;
        perpetualManager = IPerpetualManagerFront(_poolManager.perpetualManager());
        address stableMaster = _poolManager.stableMaster();
        (, ISanToken _sanToken, , IOracle _oracle, , , uint256 _collatBase, , ) = IStableMaster(stableMaster)
            .collateralMap(_poolManager);
        sanToken = _sanToken;
        collatBase = _collatBase;
        oracle = _oracle;
        agToken = IAgToken(IStableMaster(stableMaster).agToken());
        underlyingToken = IERC20(_poolManager.token());
        veANGLE = _veANGLE;
        claimTime = _claimTime;
&nbsp;
        // Access control
        for (uint256 i = 0; i &lt; governorList.length; i++) {
            require(governorList[i] != address(0), "0");
            _setupRole(GOVERNOR_ROLE, governorList[i]);
            // Governors also have the `STABLEMASTER_ROLE` to allow them to trigger settlement directly
            _setupRole(STABLEMASTER_ROLE, governorList[i]);
        }
        _setupRole(STABLEMASTER_ROLE, stableMaster);
        _setRoleAdmin(GOVERNOR_ROLE, GOVERNOR_ROLE);
        _setRoleAdmin(STABLEMASTER_ROLE, GOVERNOR_ROLE);
&nbsp;
        emit CollateralSettlerInit(address(_poolManager), address(_veANGLE), claimTime);
    }
&nbsp;
    // ========================== Contract Activation ==============================
&nbsp;
    /// @notice Activates settlement for this contract, launches claim period and freezes oracle value for HAs
    /// @param _oracleValue Value of the oracle that will be used for the settlement to get the
    /// value of HAs positions. A different oracle value is going to be defined later to convert stablecoins to
    /// collateral for users
    /// @param _sanRate Value of the `sanRate` at time of settlement to be able to convert an amount of
    /// sanTokens to an amount of collateral
    /// @param _stocksUsers Maximum amount of stablecoins that will be redeemable by users for this collateral
    /// @dev This function is to be called by the `StableMaster` after governance called `revokeCollateral` or by
    /// governance directly, in which case governance will have to pay attention to pass the right values and to
    /// pause in the concerned `StableMaster` users, HAs and SLPs. In this situation, governance has more freedom
    /// regarding the oracle value at which settlement will occur
    /// @dev This function can only be called once throughout the contract's lifetime
    /// @dev It is preferable to set the different proportion ratios at collateral deployment or before any
    /// suspicion that triggerSettlement will be called to avoid front-running
    function triggerSettlement(
        uint256 _oracleValue,
        uint256 _sanRate,
        uint256 _stocksUsers
    ) external override onlyRole(STABLEMASTER_ROLE) {
        require(startTimestamp == 0, "59");
        require(proportionalRatioGovLP != 0 &amp;&amp; proportionalRatioGovUser != 0, "60");
        oracleValueHA = _oracleValue;
        sanRate = _sanRate;
        maxStablecoinsClaimable = _stocksUsers;
        startTimestamp = block.timestamp;
        amountToRedistribute = underlyingToken.balanceOf(address(this));
        emit SettlementTriggered(amountToRedistribute);
    }
&nbsp;
    // =============================== User Claims =================================
&nbsp;
    /// @notice Allows a user to claim collateral for a `dest` address by sending agTokens
    /// @param dest Address of the user to claim collateral for
    /// @param amountAgToken Amount of agTokens sent
    /// @dev This function queries the veANGLE balance of the `msg.sender` to check if it can be treated preferably
    /// @dev The bigger the veANGLE balance of a user, the more preferably it ends up being treated during the redeem period
    function claimUser(address dest, uint256 amountAgToken) external onlyClaimPeriod whenNotPaused {
        require(dest != address(0), "0");
        require(totalSupplyUserClaimsVeANGLE + totalSupplyUserClaims + amountAgToken &lt;= maxStablecoinsClaimable, "61");
        // Since this involves a `transferFrom`, it is normal to update the variables after the transfers are done
        // No need to use `safeTransfer` for agTokens
        agToken.transferFrom(msg.sender, address(this), amountAgToken);
        uint256 balanceVeANGLE = veANGLE.balanceOf(msg.sender);
        if (balanceVeANGLE &gt; 0) {
            // From the `balanceVeANGLE`, computing the portion of the initial claim that is going to be
            // treated as a preferable claim
            uint256 amountAgTokenGov = (balanceVeANGLE * BASE_PARAMS) / proportionalRatioGovUser;
            amountAgTokenGov = amountAgTokenGov &gt; amountAgToken ? amountAgToken : amountAgTokenGov;
            amountAgToken -= amountAgTokenGov;
            totalSupplyUserClaimsVeANGLE += amountAgTokenGov;
            balanceOfUserClaimsVeANGLE[dest] += amountAgTokenGov;
            emit TotalSupplyUserClaimsVeANGLEUpdated(amountAgTokenGov);
        }
        // The claims for users are stored in stablecoin value: conversion will be done later on at the end of
        // the claim period
        totalSupplyUserClaims += amountAgToken;
        balanceOfUserClaims[dest] += amountAgToken;
        emit TotalSupplyUserClaimsUpdated(amountAgToken);
    }
&nbsp;
    // =============================== HA Claims ===================================
&nbsp;
    /// @notice Allows a HA to claim collateral by sending a `perpetualID`
    /// @param perpetualID Perpetual owned by the HA
    /// @dev The contract automatically recognizes the beneficiary of the perpetual
    /// @dev The contract fetches the veANGLE balance of the `msg.sender` to see if the claim should be treated preferably
    /// @dev If the perpetual of the HA should be liquidated then, this HA will not be able to get
    /// a claim on the remaining collateral
    function claimHA(uint256 perpetualID) external onlyClaimPeriod whenNotPaused {
        require(perpetualManager.isApprovedOrOwner(msg.sender, perpetualID), "21");
        // Getting the owner of the perpetual
        // The zero address cannot own a perpetual
        address dest = perpetualManager.ownerOf(perpetualID);
        require(haClaimCheck[perpetualID] == 0, "64");
        // A HA cannot claim a given perpetual twice
        haClaimCheck[perpetualID] = 1;
        // Computing the amount of the claim from the perpetual
        (uint256 amountInC, uint256 reachMaintenanceMargin) = perpetualManager.getCashOutAmount(
            perpetualID,
            oracleValueHA
        );
        // If the perpetual is below the maintenance margin, then the claim of the HA is null
        if (reachMaintenanceMargin != 1 &amp;&amp; amountInC &gt; 0) {
            // Updating the contract's mappings accordingly
            _treatLPClaim(dest, amountInC);
        }
    }
&nbsp;
    // =============================== SLP Claims ==================================
&nbsp;
    /// @notice Allows a SLP to claim collateral for an address `dest` by sending sanTokens
    /// @param dest Address to claim collateral for
    /// @param amountSanToken Amount of sanTokens sent
    /// @dev The contract fetches the veANGLE balance of the `msg.sender` to see if the claim should be treated preferably
    function claimSLP(address dest, uint256 amountSanToken) external onlyClaimPeriod whenNotPaused {
        require(dest != address(0), "0");
        sanToken.transferFrom(msg.sender, address(this), amountSanToken);
        // Computing the amount of the claim from the number of sanTokens sent
        uint256 amountInC = (amountSanToken * sanRate) / BASE_TOKENS;
        // Updating the contract's mappings accordingly
        _treatLPClaim(dest, amountInC);
    }
&nbsp;
    // ========================= Redeem Period =====================================
&nbsp;
    /// @notice Computes the base amount each category of claim will get after the claim period has ended
    /// @dev This function can only be called once when claim period is over
    /// @dev It is at the level of this function that the waterfall between the different
    /// categories of stakeholders and of claims is executed
    function setAmountToRedistributeEach() external whenNotPaused {
        // Checking if it is the right time to call the function: claim period should be over
        require(startTimestamp != 0 &amp;&amp; block.timestamp &gt; claimTime + startTimestamp, "63");
        // This is what guarantees that this function can only be computed once
        require(baseAmountToEachComputed == 0, "62");
        baseAmountToEachComputed = 1;
        // Fetching the oracle value at which stablecoins will be converted to collateral
        oracleValueUsers = oracle.readLower();
        // The waterfall first gives everything that's possible to stable holders which had veANGLE
        // in the limit of what is owed to them
        // We need to convert the user claims expressed in stablecoin value to claims in collateral value
        uint256 totalSupplyUserClaimsVeANGLEInC = (totalSupplyUserClaimsVeANGLE * collatBase) / oracleValueUsers;
        uint256 totalSupplyUserClaimsInC = (totalSupplyUserClaims * collatBase) / oracleValueUsers;
        if (amountToRedistribute &gt;= totalSupplyUserClaimsVeANGLEInC) {
            baseAmountToUserGov = uint64(BASE_PARAMS);
            amountToRedistribute -= totalSupplyUserClaimsVeANGLEInC;
        } else {
            baseAmountToUserGov = uint64((amountToRedistribute * BASE_PARAMS) / totalSupplyUserClaimsVeANGLEInC);
            amountToRedistribute = 0;
        }
        // Then it gives everything that remains to other stable holders (in the limit of what is owed to them)
        if (amountToRedistribute &gt; totalSupplyUserClaimsInC) {
            baseAmountToUser = uint64(BASE_PARAMS);
            amountToRedistribute -= totalSupplyUserClaimsInC;
        } else {
            baseAmountToUser = uint64((amountToRedistribute * BASE_PARAMS) / totalSupplyUserClaimsInC);
            amountToRedistribute = 0;
        }
        // After that, LPs which had veANGLE claims are going to be treated: once again the contract
        // gives them everything it can in the limit of their claim
        if (amountToRedistribute &gt; totalSupplyLpClaimsVeANGLE) {
            baseAmountToLpGov = uint64(BASE_PARAMS);
            amountToRedistribute -= totalSupplyLpClaimsVeANGLE;
        } else {
            baseAmountToLpGov = uint64((amountToRedistribute * BASE_PARAMS) / totalSupplyLpClaimsVeANGLE);
            amountToRedistribute = 0;
        }
        // And last, LPs claims without veANGLE are handled
        if (amountToRedistribute &gt; totalSupplyLpClaims) {
            baseAmountToLp = uint64(BASE_PARAMS);
            amountToRedistribute -= totalSupplyLpClaims;
        } else {
            baseAmountToLp = uint64((amountToRedistribute * BASE_PARAMS) / totalSupplyLpClaims);
            amountToRedistribute = 0;
        }
&nbsp;
        emit AmountToRedistributeAnnouncement(
            baseAmountToUserGov,
            baseAmountToUser,
            baseAmountToLpGov,
            baseAmountToLp,
            amountToRedistribute
        );
    }
&nbsp;
    /// @notice Lets a user or a LP redeem its corresponding share of collateral
    /// @param user Address of the user to redeem collateral to
    /// @dev This function can only be called after the `setAmountToRedistributeEach` function has been called
    /// @dev The entry point to redeem is the same for users, HAs and SLPs
    function redeemCollateral(address user) external onlyBaseAmountsComputed whenNotPaused {
        // Converting the claims stored for each user in collateral value
        uint256 amountToGive = ((balanceOfUserClaimsVeANGLE[user] * collatBase * baseAmountToUserGov) /
            oracleValueUsers +
            (balanceOfUserClaims[user] * collatBase * baseAmountToUser) /
            oracleValueUsers +
            balanceOfLpClaimsVeANGLE[user] *
            baseAmountToLpGov +
            balanceOfLpClaims[user] *
            baseAmountToLp) / BASE_PARAMS;
        // Deleting the amounts stored for each so that someone cannot come and claim twice
        delete balanceOfUserClaimsVeANGLE[user];
        delete balanceOfUserClaims[user];
        delete balanceOfLpClaimsVeANGLE[user];
        delete balanceOfLpClaims[user];
        if (amountToGive &gt; 0) {
            underlyingToken.safeTransfer(user, amountToGive);
        }
    }
&nbsp;
    // ============================== Governance ===================================
&nbsp;
    /// @notice Changes the amount that can be redistributed with this contract
    /// @param newAmountToRedistribute New amount that can be given by this contract
    /// @dev This function should typically be called after the settlement trigger and after this contract
    /// receives more collateral
    function setAmountToRedistribute(uint256 newAmountToRedistribute) external onlyRole(GOVERNOR_ROLE) onlyClaimPeriod {
        require(underlyingToken.balanceOf(address(this)) &gt;= newAmountToRedistribute, "66");
        amountToRedistribute = newAmountToRedistribute;
&nbsp;
        emit AmountRedistributeUpdated(amountToRedistribute);
    }
&nbsp;
    /// @notice Recovers leftover tokens from the contract or tokens that were mistakenly sent to the contract
    /// @param tokenAddress Address of the token to recover
    /// @param to Address to send the remaining tokens to
    /// @param amountToRecover Amount to recover from the contract
    /// @dev It can be used after the `setAmountToDistributeEach` function has been called to allocate
    /// the surplus of the contract elsewhere
    /// @dev It can also be used to recover tokens that are mistakenly sent to this contract
    function recoverERC20(
        address tokenAddress,
        address to,
        uint256 amountToRecover
    ) external onlyRole(GOVERNOR_ROLE) onlyBaseAmountsComputed {
        if (tokenAddress == address(underlyingToken)) {
            require(amountToRedistribute &gt;= amountToRecover, "66");
            amountToRedistribute -= amountToRecover;
            underlyingToken.safeTransfer(to, amountToRecover);
        } else {
            IERC20(tokenAddress).safeTransfer(to, amountToRecover);
        }
        emit Recovered(tokenAddress, to, amountToRecover);
    }
&nbsp;
    /// @notice Changes the veANGLE proportionality ratio used to compute the claims
    /// with veANGLE
    /// @param _proportionalRatioGovUser New ratio for users
    /// @param _proportionalRatioGovLP New ratio for LPs (both SLPs and HAs)
    /// @dev This function can only be called before the claim period and settlement trigger: there could be
    /// a governance attack if these ratios can be modified during the claim period
    function setProportionalRatioGov(uint64 _proportionalRatioGovUser, uint64 _proportionalRatioGovLP)
        external
        onlyRole(GOVERNOR_ROLE)
    {
        require(startTimestamp == 0, "65");
        proportionalRatioGovUser = _proportionalRatioGovUser;
        proportionalRatioGovLP = _proportionalRatioGovLP;
        emit ProportionalRatioGovUpdated(proportionalRatioGovUser, proportionalRatioGovLP);
    }
&nbsp;
    /// @notice Pauses pausable methods, that is all the claim and redeem methods
    function pause() external onlyRole(GOVERNOR_ROLE) {
        _pause();
    }
&nbsp;
    /// @notice Unpauses paused methods
    function unpause() external onlyRole(GOVERNOR_ROLE) {
        _unpause();
    }
&nbsp;
    // ============================= Internal Function =============================
&nbsp;
    /// @notice Handles a claim after having computed the amount in collateral (`amountInC`) from the claim
    /// for a SLP or a HA
    /// @param dest Address the claim will be for
    /// @param amountInC Amount in collateral for the claim
    /// @dev This function is called after the amount from a claim has been computed
    /// @dev This function computes the veANGLE balance of the `msg.sender` to see whether it should be treated preferably
    /// @dev It is at the level of this function that it is seen from the proportional ratios whether a LP claim is
    /// a preferable claim (involving veANGLE owned) or not
    function _treatLPClaim(address dest, uint256 amountInC) internal {
        uint256 balanceVeANGLE = veANGLE.balanceOf(msg.sender);
        if (balanceVeANGLE &gt; 0) {
            uint256 amountInCGov = (balanceVeANGLE * BASE_PARAMS) / proportionalRatioGovLP;
            amountInCGov = amountInCGov &gt; amountInC ? amountInC : amountInCGov;
            amountInC -= amountInCGov;
            totalSupplyLpClaimsVeANGLE += amountInCGov;
            balanceOfLpClaimsVeANGLE[dest] += amountInCGov;
            emit TotalSupplyLpVeANGLEUpdated(amountInCGov);
        }
        totalSupplyLpClaims += amountInC;
        balanceOfLpClaims[dest] += amountInC;
        emit TotalSupplyLpUpdated(amountInC);
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Feb 16 2022 18:02:19 GMT+0100 (Central European Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
