<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for ercManager/ERCManager.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">ercManager/</a> ERCManager.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">98.29% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>115/117</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">89.47% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>34/38</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>23/23</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>115/115</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">29×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55×</span>
<span class="cline-any cline-yes">55×</span>
<span class="cline-any cline-yes">55×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55×</span>
<span class="cline-any cline-yes">55×</span>
<span class="cline-any cline-yes">55×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55×</span>
<span class="cline-any cline-yes">55×</span>
<span class="cline-any cline-yes">55×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">53×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">25×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: COMING SOON
&nbsp;
pragma solidity 0.8.2;
&nbsp;
import "./ERCManagerInternal.sol";
&nbsp;
/// @title ERCManager
/// @author Angle Core Team
/// @notice The `ERCManager` contract corresponds to a collateral pool of the protocol for a stablecoin,
/// it manages a single ERC20 token
/// @dev This file contains the functions that are callable by governance or by other contracts of the protocol
/// @dev References to this contract are called interchangeably `ERCManager` or manager
contract ERCManager is ERCManagerInternal, IManagerFunctions, PausableMap {
    using SafeERC20 for IERC20;
&nbsp;
    bytes32 public constant HA = keccak256("HA");
    bytes32 public constant SLP = keccak256("SLP");
    bytes32 public constant STABLE_HOLDER = keccak256("STABLE_HOLDER");
&nbsp;
    // ======================== Getters - View Functions ===========================
    // The following view functions have been put here because they are part of the interface
&nbsp;
    /// @notice Gets the current balance of this collateral manager
    /// @return The amount of the underlying collateral that the contract currently owns
    /// @dev This balance does not take into account what has been lent to lending platforms
    function getBalance() external view override returns (uint256) {
        return _getBalance();
    }
&nbsp;
    /// @notice Gets the total amount of collateral that is controlled by this collateral manager
    /// @return The amount of owned by this contract plus the amount that has been lent to lending platforms
    /// @dev This is the value that is used to compute the lending rate for a given lending platform
    function getTotalAsset() external view override returns (uint256) {
        return _getTotalAsset();
    }
&nbsp;
    // ========================= `StableMaster` Functions ==========================
&nbsp;
    /// @notice Changes the references to contracts from this protocol with which this collateral manager interacts
    /// @param governorList List of the governor addresses of protocol
    /// @param guardian Address of the guardian of the protocol (it can be revoked)
    /// @param _sanToken New reference to the `SanToken` contract associated to the pair stablecoin/collateral
    /// @param _perpetualManager New reference to the `PerpetualManager` contract containing all the logic for HAs
    function deployCollateral(
        address[] memory governorList,
        address guardian,
        ISanToken _sanToken,
        IPerpetualManager _perpetualManager,
        IKeeperFees _keeper
    ) external override onlyRole(STABLEMASTER_ROLE) {
        // These references need to be stored to be able to propagate changes and maintain
        // the protocol's integrity when changes are posted from the `StableMaster`
        sanToken = _sanToken;
        perpetualManager = _perpetualManager;
        keeper = _keeper;
&nbsp;
        // Access control
        for (uint256 i = 0; i &lt; governorList.length; i++) {
            grantRole(GOVERNOR_ROLE, governorList[i]);
            grantRole(GUARDIAN_ROLE, governorList[i]);
        }
        grantRole(GUARDIAN_ROLE, guardian);
&nbsp;
        // Propagates the changes to the other involved contracts
        perpetualManager.deployCollateral(governorList, guardian, _keeper);
        sanToken.init(governorList, guardian);
        keeper.init(governorList, guardian);
&nbsp;
        // `StableMaster` needs to have approval to directly transfer some of this contract's tokens
        _changeTokenApprovalAmount(address(stableMaster), type(uint256).max);
    }
&nbsp;
    /// @notice Adds a new governor address and echoes it to other contracts
    /// @param _governor New governor address
    function addGovernor(address _governor) external override onlyRole(STABLEMASTER_ROLE) {
        // Access control for this contract
        grantRole(GOVERNOR_ROLE, _governor);
        // Echoes the change to other contracts interacting with this collateral manager
        // Since the other contracts interacting with this manager do not have governor roles,
        // we just need it to set the new govenor as guardian in these contracts
        _addGuardian(_governor);
    }
&nbsp;
    /// @notice Removes a governor address and echoes it to other contracts
    /// @param _governor Governor address to remove
    function removeGovernor(address _governor) external override onlyRole(STABLEMASTER_ROLE) {
        // Access control for this contract
        revokeRole(GOVERNOR_ROLE, _governor);
        _revokeGuardian(_governor);
    }
&nbsp;
    /// @notice Changes the guardian address and echoes it to other contracts that interact with this `ERCManager`
    /// @param _guardian New guardian address
    /// @param guardian Old guardian address to revoke
    function setGuardian(address _guardian, address guardian) external override onlyRole(STABLEMASTER_ROLE) {
        _addGuardian(_guardian);
        _revokeGuardian(guardian);
    }
&nbsp;
    /// @notice Revokes the guardian address and echoes the change to other contracts that interact with this manager
    /// @param guardian Address of the guardian to revoke
    function revokeGuardian(address guardian) external override onlyRole(STABLEMASTER_ROLE) {
        _revokeGuardian(guardian);
    }
&nbsp;
    /// @notice Sets a new `StableMaster` contract
    /// @param _stableMaster New `StableMaster` ontract
    function setStableMaster(address _stableMaster) external override onlyRole(STABLEMASTER_ROLE) {
        // Access control for this contract
        grantRole(STABLEMASTER_ROLE, _stableMaster);
        grantRole(GOVERNOR_ROLE, _stableMaster);
        grantRole(GUARDIAN_ROLE, _stableMaster);
&nbsp;
        revokeRole(GOVERNOR_ROLE, address(stableMaster));
        revokeRole(GUARDIAN_ROLE, address(stableMaster));
        revokeRole(STABLEMASTER_ROLE, address(stableMaster));
&nbsp;
        // Updating the approval amounts
        _changeTokenApprovalAmount(address(stableMaster), 0);
        _changeTokenApprovalAmount(address(_stableMaster), type(uint256).max);
&nbsp;
        stableMaster = IStableMaster(_stableMaster);
&nbsp;
        // Propagates the changes to other contracts
        perpetualManager.setStableMaster(_stableMaster);
        sanToken.setStableMaster(_stableMaster);
        keeper.setStableMaster(_stableMaster);
    }
&nbsp;
    /// @notice Allows to propagate the change of keeper for the collateral/stablecoin pair
    /// @param _keeper New keeper contract
    function setKeeper(IKeeperFees _keeper) external override onlyRole(STABLEMASTER_ROLE) {
        // Changing the reference in the `PerpetualManager` contract where keepers are involved
        keeper = _keeper;
        perpetualManager.setKeeper(_keeper);
    }
&nbsp;
    // ============================= Yield Farming =================================
&nbsp;
    /// @notice Tells a strategy how much it can borrow from the manager
    /// @return Amount of token a strategy has access to as a credit line
    /// @dev Since this function is a view function, there is no need to have an access control logic
    /// even though it will just be relevant for a strategy
    function creditAvailable() external view override returns (uint256) {
        StrategyParams storage params = strategies[msg.sender];
&nbsp;
        uint256 target = (_getTotalAsset() * params.debtRatio) / BASE;
&nbsp;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (target &lt; params.totalDebt) <span class="cstat-no" title="statement not covered" >return 0;</span>
&nbsp;
        return Math.min(target - params.totalDebt, _getBalance());
    }
&nbsp;
    /// @notice Tells a strategy how much it can owns to the manager
    /// @return Amount of token a strategy has to reimburse
    function debtOutstanding() external view override returns (uint256) {
        StrategyParams storage params = strategies[msg.sender];
&nbsp;
        uint256 target = (_getTotalAsset() * params.debtRatio) / BASE;
&nbsp;
        if (target &gt; params.totalDebt) return 0;
&nbsp;
        return (params.totalDebt - target);
    }
&nbsp;
    /// @notice Reports the gains or loss made by a strategy
    /// @param gain Amount strategy has realized as a gain on its investment since its
    /// last report, and is free to be given back to Manager as earnings
    /// @param loss Amount strategy has realized as a loss on its investment since its
    /// last report, and should be accounted for on the Manager's balance sheet.
    /// The loss will reduce the debtRatio. The next time the strategy will harvest,
    /// it will pay back the debt in an attempt to adjust to the new debt limit.
    /// @param debtPayment Amount strategy has made available to cover outstanding debt
    /// @dev This is the main contact point where the strategy interacts with the Manager
    /// @dev The strategy reports back what it has free, then the Manager contract "decides"
    /// whether to take some back or give it more. Note that the most it can
    /// take is `gain + _debtPayment`, and the most it can give is all of the
    /// remaining reserves. Anything outside of those bounds is abnormal behavior.
    function report(
        uint256 gain,
        uint256 loss,
        uint256 debtPayment
    ) external override onlyRole(STRATEGY_ROLE) {
        require(
            token.balanceOf(msg.sender) &gt;= gain + debtPayment,
            "ERCManager::report: incorrect freed amount by strategy"
        );
&nbsp;
        StrategyParams storage params = strategies[msg.sender];
&nbsp;
        // Updating parameters in the perpetualManager
        // This needs to be done now because it has implications in _getTotalAsset()
        params.totalDebt = params.totalDebt + gain - loss;
        totalDebt = totalDebt + gain - loss;
        params.lastReport = block.timestamp;
&nbsp;
        uint256 target = ((_getTotalAsset()) * params.debtRatio) / BASE;
        // If the strategy has some credit left
        if (target &gt; params.totalDebt) {
            // If the strategy has some credit left, tokens can be transferred by this strategy
            uint256 available = Math.min(target - params.totalDebt, _getBalance());
            params.totalDebt = params.totalDebt + available;
            totalDebt = totalDebt + available;
            <span class="missing-if-branch" title="else path not taken" >E</span>if (available &gt; 0) {
                token.safeTransfer(msg.sender, available);
            }
        } else {
            uint256 available = Math.min(params.totalDebt - target, debtPayment + gain);
            params.totalDebt = params.totalDebt - available;
            totalDebt = totalDebt - available;
            if (available &gt; 0) {
                token.safeTransferFrom(msg.sender, address(this), available);
            }
        }
        emit StrategyReported(msg.sender, gain, loss, debtPayment, params.totalDebt);
&nbsp;
        // Handle eventual losses
        if (loss &gt; 0) {
            stableMaster.signalLoss(loss);
        }
        // Handle gains
        if (gain &gt; 0) {
            stableMaster.accumulateInterest(gain);
            emit DistributingFees(gain);
        }
    }
&nbsp;
    // =========================== Governor Functions ==============================
&nbsp;
    /// @notice Allows to recover all ERC20 tokens and to send it to a contract (like the settlement contract)
    /// @param settlementContract Address of the contract to send collateral to
    /// @param amount Amount of collateral to transfer
    /// @dev As this function can be used to transfer funds to another contract, it has to be a GOVERNOR function
    function transferToSettlement(address settlementContract, uint256 amount) external onlyRole(GOVERNOR_ROLE) {
        emit Recovered(address(token), settlementContract, amount);
        token.safeTransfer(settlementContract, amount);
    }
&nbsp;
    // =========================== Guardian Functions ==============================
&nbsp;
    /// @notice Pauses an agent's actions within this contract
    /// @param agent Type of agent that is going to be prevented to interact with this contract
    /// @dev agent is either `HA`, `SLP` or `STABLE_HOLDER`
    /// @dev If agent is `STABLE_HOLDER`, it is going to be impossible for users to mint stablecoins using collateral
    /// @dev If agent is `HA`, it is going to be impossible for HAs to open new perpetuals, to cash out their perpetuals
    /// to add or remove collateral from their perpetuals, or to liquidate or force the exit of another perpetual
    /// @dev If agent is `SLP`, it is going to be impossible for SLPs to deposit collateral and receive
    /// sanTokens in exchange
    function pause(bytes32 agent) external override onlyRole(GUARDIAN_ROLE) {
        _pause(agent);
    }
&nbsp;
    /// @notice Unpauses the agent's actions in this contract
    /// @param agent Agent to unpause the action of
    /// @dev Before calling this function, the agent should have been paused
    function unpause(bytes32 agent) external override onlyRole(GUARDIAN_ROLE) {
        _unpause(agent);
    }
&nbsp;
    /// @notice Sets the proportion of fees going to the keepers when liquidating a HA perpetual
    /// @param _keeperFeesRatio Proportion to keepers
    /// @dev This proportion should be inferior to BASE
    function setKeeperFeesRatio(uint256 _keeperFeesRatio)
        external
        onlyRole(GUARDIAN_ROLE)
        onlyCompatibleFees(_keeperFeesRatio)
    {
        keeperFeesRatio = _keeperFeesRatio;
        emit KeeperFeesRatioUpdate(keeperFeesRatio);
    }
&nbsp;
    /// @notice Sets the maximum amount going to the keepers when cashing out an external user
    /// because too much was covered by HAs
    /// @param _keeperFeesCap Maximum fee amount going to the keeper
    function setKeeperFeesCap(uint256 _keeperFeesCap) external onlyRole(GUARDIAN_ROLE) {
        keeperFeesCap = _keeperFeesCap;
        emit KeeperFeesCapUpdate(keeperFeesCap);
    }
&nbsp;
    /// @notice Sets the x-array (ie thresholds) for keeper fees when cashing out perpetuals and the y-array that is the
    /// value of the proportions of the fees going to keepers cashing out perpetuals
    /// @param _xKeeperFeesCashOut Thresholds for cash out fees
    /// @param _yKeeperFeesCashOut Value of the fees at the different threshold values specified in xKeeperFeesCashOut
    /// @dev The x thresholds correspond to different values of the ratio between the amount that is covered
    /// by a perpetual and the surplus amount that HAs cover and that should not be covered
    /// @dev `xKeeperFeesCashOut` and `yKeeperFeesCashOut` should have the same length
    function setKeeperFeesCashOut(uint256[] memory _xKeeperFeesCashOut, uint256[] memory _yKeeperFeesCashOut)
        external
        onlyRole(GUARDIAN_ROLE)
        onlyCompatibleInputArrays(_xKeeperFeesCashOut, _yKeeperFeesCashOut, true)
    {
        xKeeperFeesCashOut = _xKeeperFeesCashOut;
        yKeeperFeesCashOut = _yKeeperFeesCashOut;
        emit KeeperFeesCashOutUpdate(xKeeperFeesCashOut, yKeeperFeesCashOut);
    }
&nbsp;
    /// @notice Modifies the funds a strategy has access to
    /// @param strategy The address of the Strategy
    /// @param _debtRatio The share of the total assets that the `strategy` has access to
    /// @dev The update has to be such that the debtRatio does not exceeds the 100% threshold
    /// as the manager cannot lend collateral that it doesn't not own.
    function updateStrategyDebtRatio(address strategy, uint256 _debtRatio) external onlyRole(GUARDIAN_ROLE) {
        _updateStrategyDebtRatio(strategy, _debtRatio);
    }
&nbsp;
    /// @notice Triggers an emergency exit for a strategy and then harvests it to fetch all the funds
    /// @param strategy The address of the Strategy
    function setStrategyEmergencyExit(address strategy) external onlyRole(GUARDIAN_ROLE) {
        _updateStrategyDebtRatio(strategy, 0);
        IStrategy(strategy).setEmergencyExit();
        IStrategy(strategy).harvest();
    }
&nbsp;
    /// @notice Adds a strategy to the Manager
    /// @param strategy The address of the strategy to add
    /// @param _debtRatio The share of the total assets that the strategy has access to
    /// @dev Multiple checks are made such that the contract must not already belong to the `ERCManager`
    /// but also that the tokens considered are consistent in both strategy and `ERCManager` contracts
    function addStrategy(address strategy, uint256 _debtRatio) external onlyRole(GUARDIAN_ROLE) zeroCheck(strategy) {
        StrategyParams storage params = strategies[strategy];
&nbsp;
        require(params.lastReport == 0, "ERCManager::addStrategy: strategy already added");
        require(
            address(this) == IStrategy(strategy).manager(),
            "ERCManager::addStrategy: strategy not bound to this manager"
        );
        // Using current code, this condition should always be verified as in the constructor
        // of the strategy the want() is set to the token of the manager
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            address(token) == IStrategy(strategy).want(),
            "ERCManager::addStrategy: strategy not linked to the right token"
        );
        require(debtRatio + _debtRatio &lt;= BASE, "ERCManager::addStrategy: debt ratio above one");
&nbsp;
        // Add strategy to approved strategies
        params.lastReport = 1;
        params.totalDebt = 0;
        params.debtRatio = _debtRatio;
&nbsp;
        grantRole(STRATEGY_ROLE, strategy);
        emit StrategyAdded(strategy, debtRatio);
&nbsp;
        // Update global parameters
        debtRatio += _debtRatio;
&nbsp;
        strategyList.push(strategy);
    }
&nbsp;
    /// @notice Revokes a strategy
    /// @param strategy The address of the strategy to revoke
    /// @dev Should only be called after the following happened in order: the `strategy.debtRatio` has been set to 0
    /// harvest has been called enough times to recover all capital gain/losses.
    function revokeStrategy(address strategy) external onlyRole(GUARDIAN_ROLE) {
        StrategyParams storage params = strategies[strategy];
&nbsp;
        require(params.debtRatio == 0, "ERCManager::revokeStrategy: strategy still managing some funds");
        require(params.totalDebt == 0, "ERCManager::revokeStrategy: strategy still managing some funds");
        require(params.lastReport != 0, "ERCManager::revokeStrategy: invalid strategy");
        // Checking the correctness of the platform and taking advantage of that to remove the platform
        // from the strategyList
        uint256 indexMet = 0;
        for (uint256 i = 0; i &lt; strategyList.length - 1; i++) {
            if (strategyList[i] == strategy) {
                indexMet = 1;
            }
            if (indexMet == 1) {
                strategyList[i] = strategyList[i + 1];
            }
        }
&nbsp;
        strategyList.pop();
&nbsp;
        // Update global parameters
        debtRatio -= params.debtRatio;
        delete strategies[strategy];
&nbsp;
        revokeRole(STRATEGY_ROLE, strategy);
&nbsp;
        emit StrategyRevoked(strategy);
    }
&nbsp;
    /// @notice Withdraws a given amount from a strategy
    /// @param strategy The address of the strategy
    /// @param strategy The amount to withdraw
    /// @dev Trying to recover amount from the strategy, but it may not go through as we may not be able to withdraw
    /// from the lending protocol the full amount. In this last case we only update the parameters by setting the loss
    /// as the gap between what has been asked and what has been returned.
    function withdrawFromStrategy(IStrategy strategy, uint256 amount) external onlyRole(GUARDIAN_ROLE) {
        StrategyParams storage params = strategies[address(strategy)];
        require(params.lastReport != 0, "ERCManager::withdrawFromStrategy: invalid strategy");
&nbsp;
        uint256 loss;
        (amount, loss) = strategy.withdraw(amount);
&nbsp;
        // Handling eventual losses
        params.totalDebt = params.totalDebt - loss - amount;
        totalDebt = totalDebt - loss - amount;
&nbsp;
        emit StrategyReported(msg.sender, 0, loss, amount - loss, params.totalDebt);
&nbsp;
        // Handle eventual losses
        // With the strategy we are using in current tests, it is going to be impossible to have
        // a positive loss by calling strategy.withdraw, this function indeed calls _liquidatePosition
        // which output value is always zero
        <span class="missing-if-branch" title="if path not taken" >I</span>if (loss &gt; 0) <span class="cstat-no" title="statement not covered" >stableMaster.signalLoss(loss)</span>;
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Jul 14 2021 10:59:30 GMT+0200 (Central European Summer Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
